<div
  class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-white min-h-screen flex flex-col items-center justify-center p-4 font-display relative">
  <!-- Action Buttons -->
  <div class="absolute top-4 right-4 flex gap-2 z-10">
    <button (click)="restartGame()"
      class="size-12 rounded-full bg-white dark:bg-gray-800/80 backdrop-blur-sm shadow-lg border border-gray-200 dark:border-gray-700 flex items-center justify-center text-amber-500 hover:text-amber-600 hover:bg-gray-100 dark:hover:bg-gray-700 transition-all">
      <span class="material-symbols-outlined !text-3xl">refresh</span>
    </button>
    <a routerLink="/games"
      class="size-12 rounded-full bg-white dark:bg-gray-800/80 backdrop-blur-sm shadow-lg border border-gray-200 dark:border-gray-700 flex items-center justify-center text-blue-500 hover:text-blue-600 hover:bg-gray-100 dark:hover:bg-gray-700 transition-all">
      <span class="material-symbols-outlined !text-3xl">arrow_back</span>
    </a>
  </div>

  <div class="w-full max-w-7xl mx-auto">
    <!-- Start Screen -->
    @if (gameState() === 'start') {
    <div
      class="bg-white dark:bg-[#1a2632] rounded-2xl shadow-xl border border-gray-200 dark:border-gray-800 p-8 text-center flex flex-col items-center gap-6 animate-fade-in text-gray-900 dark:text-white">
      <div class="size-20 bg-red-600/10 text-red-600 rounded-full flex items-center justify-center">
        <span class="material-symbols-outlined !text-5xl">timeline</span>
      </div>
      <h1 class="text-4xl md:text-5xl font-black uppercase italic tracking-tighter">{{ 'games.cableado_maestro.title' |
        i18n }}</h1>
      <p class="text-gray-600 dark:text-gray-400 max-w-lg font-medium">
        {{ 'games.cableado_maestro.subtitle' | i18n }}
      </p>
      <button (click)="startGame()"
        class="w-full md:w-auto flex items-center justify-center gap-3 rounded-xl h-14 px-8 bg-blue-600 text-white text-lg font-black uppercase tracking-tighter hover:bg-blue-500 transition-transform hover:scale-105 shadow-xl shadow-blue-600/20">
        <span class="material-symbols-outlined font-normal">play_circle</span>
        <span>{{ 'games.play' | i18n }}</span>
      </button>
    </div>
    }

    <!-- Playing Screen -->
    @if (gameState() === 'playing') {
    <div
      class="bg-white dark:bg-[#1a2632] rounded-2xl shadow-xl border border-gray-200 dark:border-gray-800 animate-fade-in overflow-hidden text-gray-900 dark:text-white">
      <header class="p-4 border-b border-gray-200 dark:border-gray-800 flex justify-between items-center">
        <h2 class="font-black text-lg uppercase italic tracking-tighter">{{ 'games.cableado_maestro.title' | i18n }}
        </h2>
        <div class="flex items-center gap-4">
          <div class="w-48 text-right">
            <p class="font-black text-[10px] uppercase tracking-widest text-gray-500">PROGRESO</p>
            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5 mt-1">
              <div class="bg-blue-600 h-2.5 rounded-full transition-all" [style.width]="progress() + '%'"></div>
            </div>
          </div>
          <p class="font-black text-xl italic tracking-tighter">{{ userConnections().length }}<span
              class="text-gray-500 mx-1">/</span>{{ requiredConnectionsCount }}</p>
        </div>
      </header>
      <div class="flex flex-col xl:flex-row">
        <aside
          class="xl:w-[500px] p-4 bg-gray-50 dark:bg-[#111a22]/50 border-b xl:border-b-0 xl:border-r border-gray-200 dark:border-gray-800">
          <h3 class="font-black text-xs uppercase tracking-widest text-gray-500 mb-4">Esquema de Referencia</h3>
          <img src="/assets/images/inversion-giro-p-c.png" alt="Esquema"
            class="rounded-xl shadow-2xl w-full border border-gray-200 dark:border-gray-800">
          <p class="mt-4 text-[10px] font-medium text-gray-500 leading-relaxed italic">{{
            'games.cableado_maestro.instruction' | i18n }}</p>
        </aside>
        <main class="flex-1 p-4 md:p-8" [class.animate-shake]="errorState()" style="animation-duration: 300ms;">
          <div
            class="bg-gray-200 dark:bg-[#0a0f14] w-[520px] h-[400px] mx-auto rounded-3xl shadow-inner relative border-4 border-gray-300 dark:border-gray-800">
            <!-- Components -->
            <div
              class="absolute top-20 left-5 w-40 h-40 bg-gray-300 dark:bg-gray-900/50 rounded-2xl flex items-center justify-center text-[10px] font-black uppercase text-gray-400">
              KM1</div>
            <div
              class="absolute top-20 left-48 w-40 h-40 bg-gray-300 dark:bg-gray-900/50 rounded-2xl flex items-center justify-center text-[10px] font-black uppercase text-gray-400">
              KM2</div>
            <div
              class="absolute top-60 left-48 w-40 h-20 bg-gray-300 dark:bg-gray-900/50 rounded-2xl flex items-center justify-center text-[10px] font-black uppercase text-gray-400">
              F1</div>
            <div
              class="absolute top-20 left-[380px] w-12 h-40 bg-gray-300 dark:bg-gray-900/50 rounded-2xl flex items-center justify-center text-[10px] font-black uppercase text-gray-400 -rotate-90 origin-center translate-x-12 translate-y-12 whitespace-nowrap">
              Botones</div>

            <!-- Terminals -->
            @for(terminal of objectValues(terminals); track terminal.id) {
            <button (click)="handleTerminalClick(terminal.id)" [title]="terminal.id"
              class="absolute size-3.5 bg-gray-500 dark:bg-gray-700 rounded-full border-2 border-white dark:border-gray-900 hover:bg-blue-500 hover:scale-125 transition-all z-20 shadow-sm"
              [style.left.px]="terminal.x - 7" [style.top.px]="terminal.y - 7"
              [class.bg-blue-500]="selectedTerminal()?.id === terminal.id"
              [class.ring-4]="selectedTerminal()?.id === terminal.id"
              [class.ring-blue-500/30]="selectedTerminal()?.id === terminal.id">
            </button>
            }

            <!-- Wires -->
            <svg class="absolute inset-0 w-full h-full overflow-visible z-10" style="pointer-events: none;">
              <defs>
                <filter id="glow">
                  <feGaussianBlur stdDeviation="1.5" result="coloredBlur" />
                  <feMerge>
                    <feMergeNode in="coloredBlur" />
                    <feMergeNode in="SourceGraphic" />
                  </feMerge>
                </filter>
              </defs>
              @for(conn of userConnections(); track conn) {
              <line [attr.x1]="terminals[conn.from].x" [attr.y1]="terminals[conn.from].y"
                [attr.x2]="terminals[conn.to].x" [attr.y2]="terminals[conn.to].y" stroke="#3b82f6" stroke-width="3"
                stroke-linecap="round" filter="url(#glow)" />
              }
            </svg>
          </div>
        </main>
      </div>
    </div>
    }

    <!-- Finished Screen -->
    @if (gameState() === 'finished') {
    <div
      class="bg-white dark:bg-[#1a2632] rounded-2xl shadow-xl border border-gray-200 dark:border-gray-800 p-8 text-center flex flex-col items-center gap-6 animate-fade-in text-gray-900 dark:text-white">
      <div
        class="size-20 bg-green-100 dark:bg-green-900/30 text-green-500 rounded-full flex items-center justify-center">
        <span class="material-symbols-outlined !text-5xl">emoji_events</span>
      </div>
      <h1 class="text-3xl md:text-4xl font-black uppercase italic tracking-tighter">¡Circuito Completado!</h1>
      <p
        class="text-gray-600 dark:text-gray-400 text-lg max-w-md font-medium leading-relaxed italic border-l-4 border-green-500 px-6 py-2 bg-green-500/5 rounded-r-xl">
        ¡Excelente trabajo! Has cableado la inversión de giro con éxito. Eres un asere de los esquemas.</p>

      <div class="flex flex-col md:flex-row gap-4 w-full mt-4">
        <button (click)="restartGame()"
          class="w-full flex items-center justify-center gap-3 rounded-xl h-14 px-6 bg-blue-600 text-white font-black uppercase tracking-tighter hover:bg-blue-500 transition-transform hover:scale-105 shadow-xl shadow-blue-600/20">
          <span class="material-symbols-outlined">refresh</span>
          <span>Volver a Jugar</span>
        </button>
        <a routerLink="/games"
          class="w-full flex items-center justify-center gap-2 rounded-xl h-14 px-6 bg-gray-200 dark:bg-gray-800 text-gray-800 dark:text-gray-200 font-black uppercase tracking-tighter hover:bg-gray-300 dark:hover:bg-gray-700 transition-colors">
          <span class="material-symbols-outlined">sports_esports</span>
          <span>Otros Juegos</span>
        </a>
      </div>
    </div>
    }
  </div>
</div>